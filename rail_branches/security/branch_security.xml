<?xml version="1.0" encoding="utf-8"?>
<odoo>
<data>

    <record model="ir.module.category" id="module_branch_management">
        <field name="name">Sucursales</field>
        <field name="sequence">11</field>
    </record>

    <record id="group_branch_user" model="res.groups">
        <field name="name">Usuario</field>
        <field name="implied_ids" eval="[(4, ref('base.group_user'))]"/>
        <field name="category_id" ref="module_branch_management"/>
    </record>

    <record id="group_branch_user_manager" model="res.groups">
        <field name="name">Administrador</field>
        <field name="category_id" ref="module_branch_management"/>
        <field name="implied_ids" eval="[(4, ref('group_branch_user'))]"/>
        <field name="users" eval="[(4, ref('base.user_root')), (4, ref('base.user_admin'))]"/>
    </record>
        <record id="base.default_user" model="res.users">
            <field name="groups_id" eval="[(4,ref('rail_branches.group_branch_user_manager'))]"/>
        </record>    

    <!--Sucursales-->
    <record id="res_branch_manager_rule" model="ir.rule">
        <field name="name">Administrador sucursales</field>
        <field name="model_id" ref="model_res_branch"/>
        <field name="global" eval="True"/>
        <field name="domain_force">[(1,'=',1)]</field>
        <field name="groups" eval="[(4, ref('rail_branches.group_branch_user_manager'))]"/>
    </record>
    <record id="res_branch_user_rule" model="ir.rule">
        <field name="name">Usuario sucursales</field>
        <field name="model_id" ref="model_res_branch"/>
        <field name="global" eval="True"/>
        <field name="domain_force">[('id','=',user.branch_id.id)]</field>
        <field name="groups" eval="[(4, ref('rail_branches.group_branch_user'))]"/>
    </record>

    <!--Ventas-->
    <record id="sale.sale_order_personal_rule" model="ir.rule">
        <field name="name">Sucursales: mis pedidos</field>
        <field ref="model_sale_order" name="model_id"/>
        <field name="domain_force">['|','&amp;','|',('branch_id','=',user.branch_id.id),('branch_id','=',False),('user_id','=',user.id),('user_id','=',False)]</field>
        <field name="groups" eval="[(4, ref('sales_team.group_sale_salesman'))]"/>
    </record>
    <record id="sale.sale_order_see_all" model="ir.rule">
        <field name="name">Sucursuales: todos los pedidos</field>
        <field ref="model_sale_order" name="model_id"/>
        <field name="domain_force">['|',('branch_id','=',False),('branch_id','=',user.branch_id.id)]</field>
        <field name="groups" eval="[(4, ref('sales_team.group_sale_salesman_all_leads'))]"/>
    </record>
    <record id="sale_order_all_manager" model="ir.rule">
        <field name="name">Sucursales: administrador de ventas</field>
        <field ref="model_sale_order" name="model_id"/>
        <field name="domain_force">[(1,'=',1)]</field>
        <field name="groups" eval="[(4,ref('sales_team.group_sale_manager'))]"/>
    </record>

    <!--Compras-->
    <record id="purchase_branch_manager_rule" model="ir.rule">
        <field name="name">Sucursales: administrador de compras</field>
        <field name="model_id" ref="model_purchase_order"/>
        <field name="global" eval="True"/>
        <field name="domain_force">[(1,'=',1)]</field>
        <field name="groups" eval="[(4, ref('rail_branches.group_branch_user_manager'))]"/>
    </record>
    <record id="purchase_branch_rule" model="ir.rule">
        <field name="name">Sucursales: usuario compras</field>
        <field name="model_id" ref="model_purchase_order"/>
        <field name="global" eval="True"/>
        <field name="domain_force">['|',('branch_id','=',False),('branch_id','=',user.branch_id.id)]</field>
        <field name="groups" eval="[(4, ref('rail_branches.group_branch_user'))]"/>
    </record>
        
    <!--Transferencias stock-->
    <record id="picking_branch_manager_rule" model="ir.rule">
        <field name="name">Sucursales: transferencias</field>
        <field name="model_id" ref="model_stock_picking"/>
        <field name="global" eval="True"/>
        <field name="domain_force">[(1,'=',1)]</field>
        <field name="groups" eval="[(4, ref('rail_branches.group_branch_user_manager'))]"/>
    </record>
    <record id="picking_branch_rule" model="ir.rule">
        <field name="name">Sucursales: transferencias  </field>
        <field name="model_id" ref="model_stock_picking"/>
        <field name="global" eval="True"/>
        <field name="domain_force">['|',('branch_id','=',False),('branch_id','=',user.branch_id.id)]</field>
        <field name="groups" eval="[(4, ref('rail_branches.group_branch_user'))]"/>
    </record>

    <!--Almacenes-->
    <record id="warehouse_branch_manager_rule" model="ir.rule">
        <field name="name">Sucursales: administrador stock</field>
        <field name="model_id" ref="stock.model_stock_warehouse"/>
        <field name="global" eval="True"/>
        <field name="domain_force">[(1,'=',1)]</field>
        <field name="groups" eval="[(4, ref('rail_branches.group_branch_user_manager'))]"/>
    </record>
    <record id="warehouse_branch_rule" model="ir.rule">
        <field name="name">Sucursales: usuario almacenes</field>
        <field name="model_id" ref="stock.model_stock_warehouse"/>
        <field name="global" eval="True"/>
        <field name="domain_force">['|',('branch_id','=',False),('branch_id','=',user.branch_id.id)]</field>
        <field name="groups" eval="[(4, ref('rail_branches.group_branch_user'))]"/>
    </record>

    <!--Ubicaciones-->
    <record id="location_branch_manager_rule" model="ir.rule">
        <field name="name">Sucursales: administrador ubicaciones</field>
        <field name="model_id" ref="model_stock_location"/>
        <field name="global" eval="True"/>
        <field name="domain_force">[(1,'=',1)]</field>
        <field name="groups" eval="[(4, ref('rail_branches.group_branch_user_manager'))]"/>
    </record>
    <record id="location_branch_rule" model="ir.rule">
        <field name="name">Sucursales: usuario ubicaciones</field>
        <field name="model_id" ref="model_stock_location"/>
        <field name="global" eval="True"/>
        <field name="domain_force">['|',('branch_id','=',False),('branch_id','=',user.branch_id.id)]</field>
        <field name="groups" eval="[(4, ref('rail_branches.group_branch_user'))]"/>
    </record>

    <!--Tipos de operacion-->
    <record id="picking_type_branch_manager_rule" model="ir.rule">
        <field name="name">Sucursales: administrador tipos de operacion</field>
        <field name="model_id" ref="stock.model_stock_picking_type"/>
        <field name="global" eval="True"/>
        <field name="domain_force">[(1,'=',1)]</field>
        <field name="groups" eval="[(4, ref('rail_branches.group_branch_user_manager'))]"/>
    </record>
    <record id="picking_type_branch_rule" model="ir.rule">
        <field name="name">Sucursales: usuario tipos de operacion</field>
        <field name="model_id" ref="stock.model_stock_picking_type"/>
        <field name="global" eval="True"/>
        <field name="domain_force">['|',('branch_id','=',False),('branch_id','=',user.branch_id.id)]</field>
        <field name="groups" eval="[(4, ref('rail_branches.group_branch_user'))]"/>
    </record>

    <!--Existencias-->
    <record id="stock_quant_branch_manager_rule" model="ir.rule">
        <field name="name">Sucursales: administrador existencias</field>
        <field name="model_id" ref="stock.model_stock_quant"/>
        <field name="global" eval="True"/>
        <field name="domain_force">[(1,'=',1)]</field>
        <field name="groups" eval="[(4, ref('rail_branches.group_branch_user_manager'))]"/>
    </record>
    <record id="stock_quant_branch_rule" model="ir.rule">
        <field name="name">Sucursales: usuario exsistencias</field>
        <field name="model_id" ref="stock.model_stock_quant"/>
        <field name="global" eval="True"/>
        <field name="domain_force">['|',('location_id.branch_id','=',False),('location_id.branch_id','=',user.branch_id.id)]</field>
        <field name="groups" eval="[(4, ref('rail_branches.group_branch_user'))]"/>
    </record>

    <!--Movimientos-->
    <record id="stock_move_line_branch_manager_rule" model="ir.rule">
        <field name="name">Sucursales: administrador lineas de movimiento</field>
        <field name="model_id" ref="stock.model_stock_move_line"/>
        <field name="global" eval="True"/>
        <field name="domain_force">[(1,'=',1)]</field>
        <field name="groups" eval="[(4, ref('rail_branches.group_branch_user_manager'))]"/>
    </record>
    <record id="stock_move_line_branch_rule" model="ir.rule">
        <field name="name">Sucursales: usuario lineas de movimientos</field>
        <field name="model_id" ref="stock.model_stock_move_line"/>
        <field name="global" eval="True"/>
        <field name="domain_force">['|',('location_dest_id.branch_id','=',False),('location_dest_id.branch_id','=',user.branch_id.id)]</field>
        <field name="groups" eval="[(4, ref('rail_branches.group_branch_user'))]"/>
    </record>

    <!--Productos-->
    <record id="product_template_branch_manager_rule" model="ir.rule">
        <field name="name">Sucursales: administrador plantilla del producto</field>
        <field name="model_id" ref="product.model_product_template"/>
        <field name="global" eval="True"/>
        <field name="domain_force">[(1,'=',1)]</field>
        <field name="groups" eval="[(4, ref('rail_branches.group_branch_user_manager'))]"/>
    </record>
    <record id="product_template_branch_rule" model="ir.rule">
        <field name="name">Sucursales: usuario plantilla del producto</field>
        <field name="model_id" ref="product.model_product_template"/>
        <field name="global" eval="True"/>
        <field name="domain_force">['|',('branch_id','=',False),('branch_id','=',user.branch_id.id)]</field>
        <field name="groups" eval="[(4, ref('rail_branches.group_branch_user'))]"/>
    </record>
    <record id="product_product_branch_manager_rule" model="ir.rule">
        <field name="name">Sucursales: administrador producto</field>
        <field name="model_id" ref="product.model_product_product"/>
        <field name="global" eval="True"/>
        <field name="domain_force">[(1,'=',1)]</field>
        <field name="groups" eval="[(4, ref('rail_branches.group_branch_user_manager'))]"/>
    </record>
    <record id="product_product_branch_rule" model="ir.rule">
        <field name="name">Sucursales: usuario producto</field>
        <field name="model_id" ref="product.model_product_product"/>
        <field name="global" eval="True"/>
        <field name="domain_force">['|',('product_tmpl_id.branch_id','=',False),('product_tmpl_id.branch_id','=',user.branch_id.id)]</field>
        <field name="groups" eval="[(4, ref('rail_branches.group_branch_user'))]"/>
    </record>

    <!--Contactos-->
    <record id="res_partner_branch_manager_rule" model="ir.rule">
        <field name="name">Sucursales: administrador contactos</field>
        <field name="model_id" ref="base.model_res_partner"/>
        <field name="global" eval="True"/>
        <field name="domain_force">['|',('branch_id','=',False),('branch_id','in',[branch.id for branch in user.branch_ids])]</field>
        <field name="groups" eval="[(4, ref('rail_branches.group_branch_user_manager'))]"/>
    </record>
        <record id="res_partner_branch_rule" model="ir.rule">
        <field name="name">Res Partner Entreprise</field>
        <field name="model_id" ref="base.model_res_partner"/>
        <field name="global" eval="True"/>
        <field name="domain_force">['|',('branch_id','=',False),('branch_id','=',user.branch_id.id)]</field>
        <field name="groups" eval="[(4, ref('rail_branches.group_branch_user'))]"/>
    </record>

    <!--Usuarios-->
    <record id="res_users_branch_manager_rule" model="ir.rule">
        <field name="name">Sucursales: administrador usuarios</field>
        <field name="model_id" ref="base.model_res_users"/>
        <field name="global" eval="True"/>
        <field name="domain_force">['|',('branch_id','=',False),('branch_id','in',[branch.id for branch in user.branch_ids])]</field>
        <field name="groups" eval="[(4, ref('rail_branches.group_branch_user_manager'))]"/>
    </record>
    <record id="res_users_branch_user_rule" model="ir.rule">
        <field name="name">Sucursales: usuario usuarios</field>
        <field name="model_id" ref="base.model_res_users"/>
        <field name="global" eval="True"/>
        <field name="domain_force">['|',('branch_id','=',False),('branch_id','=',user.branch_id.id)]</field>
        <field name="groups" eval="[(4, ref('rail_branches.group_branch_user'))]"/>
    </record>
    
    <!--Contabilidad-->
    <record id="account_move_branch_manager_rule" model="ir.rule">
        <field name="name">Sucursales: administrador asientos contables</field>
        <field name="model_id" ref="account.model_account_move"/>
        <field name="global" eval="True"/>
        <field name="domain_force">['|',('branch_id','=',False),('branch_id','in',[branch.id for branch in user.branch_ids])]</field>
        <field name="groups" eval="[(4, ref('rail_branches.group_branch_user_manager'))]"/>
    </record>
    <record id="account_move_branch_rule" model="ir.rule">
        <field name="name">Sucursales: usuario asientos</field>
        <field name="model_id" ref="account.model_account_move"/>
        <field name="global" eval="True"/>
        <field name="domain_force">['|',('branch_id','=',False),('branch_id','=',user.branch_id.id)]</field>
        <field name="groups" eval="[(4, ref('rail_branches.group_branch_user'))]"/>
    </record>
    <record id="account_move_branch_manager_rule" model="ir.rule">
        <field name="name">Sucursales: administrador entradas contables</field>
        <field name="model_id" ref="account.model_account_move_line"/>
        <field name="global" eval="True"/>
        <field name="domain_force">['|',('branch_id','=',False),('branch_id','in',[branch.id for branch in user.branch_ids])]</field>
        <field name="groups" eval="[(4, ref('rail_branches.group_branch_user_manager'))]"/>
    </record>
    <record id="account_move_line_branch_rule" model="ir.rule">
        <field name="name">Sucursales: usuario entradas contables</field>
        <field name="model_id" ref="account.model_account_move_line"/>
        <field name="global" eval="True"/>
        <field name="domain_force">['|',('branch_id','=',False),('branch_id','=',user.branch_id.id)]</field>
        <field name="groups" eval="[(4, ref('rail_branches.group_branch_user'))]"/>
    </record>

    
</data>

</odoo>
